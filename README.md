# In Falsus Demo - Asset Decryptor (v2.0)

本工具用于全自动解密《In Falsus Demo》游戏中的加密资源文件，并将其**自动重命名及分类**。

**核心功能：**
1.  **自动解密**：将加密的二进制文件转换为可播放的音频 (.ogg) 和可读文本 (.txt)。
2.  **自动还原**：基于映射表将乱码文件名恢复为原始文件名（如 `bgm/MainTitle.ogg`）。
3.  **密钥提取**：自动从内存中提取 AES 密钥并记录到日志中。

> **注意**：解密后的文件仅供个人学习、研究或 Mod 制作使用。

---

## ⚠️ 法律免责声明 (Legal Disclaimer)

**在使用本工具之前，请务必仔细阅读以下条款：**

1.  **版权归属**：本工具解密出的所有资源（包括但不限于音频、图片、文本脚本）的版权均归属于lowiro。
2.  **仅限个人学习**：本教程及工具仅供计算机安全研究、逆向工程学习或个人备份使用。
3.  **禁止非法传播**：**严禁**将解密后的原始游戏资源（如 BGM 音频文件、谱面数据）上传到任何公共网络平台、用于商业用途或进行二次分发。
4.  **后果自负**：使用者因违反上述规定而产生的任何法律纠纷（如侵犯版权），由使用者自行承担，工具作者不承担任何连带责任。

**继续使用本工具即表示您同意上述条款。**

---

## 📂 准备工作

在开始之前，请确保您已经：
1.  下载并安装了《In Falsus Demo》。
2.  找到了游戏的安装目录（通常在 Steam 库 -> 右键游戏 -> 管理 -> 浏览本地文件）。
3.  准备好了本工具提供的修改版 `Game.dll` 和 `SamDecryptor.dll`以及**StreamingAssetsMapping.json**（文件名映射表）。

---

## 🚀 使用步骤

### 1. 备份核心文件
进入游戏目录下的 `Managed` 文件夹：
`..\In Falsus Demo\if-app_Data\Managed\`
找到原版的 **`Game.dll`** 并将其复制一份到安全的地方进行备份。
> **重要**：这是恢复游戏正常运行的关键步骤。

### 2. 部署工具
1.  将修改版的 **`Game.dll`** 复制到 `Managed` 文件夹中，覆盖原文件。
2.  将 **`SamDecryptor.dll`** 放入游戏根目录（即 `if-app.exe` 所在的目录）。
3.  将 **`StreamingAssetsMapping.json`** 放入游戏根目录。

### 3. 准备加密源文件 (可选)
工具默认会自动读取游戏自带的 `sam` 文件夹。
为了安全起见，您也可以手动操作：
1.  在游戏根目录新建文件夹 **`EncryptedSource`**。
2.  将 `..\if-app_Data\StreamingAssets\sam\` 中的所有文件复制进去。
*(如果存在 `EncryptedSource`，工具会优先读取它，避免修改游戏原文件)*

### 4. 运行解密
1.  在 Steam 中启动游戏。
2.  等待游戏加载，直到出现**标题界面**。
3.  此时解密程序已在后台自动运行。

### 5. 获取结果
回到游戏根目录，您会看到两个新文件夹：

*   **`DecryptedOutput`**：存放解密后的原始文件（文件名仍为 32 位哈希，用于调试）。
*   **`RestoredAssets`**：**[推荐使用]** 存放已重命名并分类好的最终文件。
    *   `audio/bgm/`: 背景音乐
    *   `audio/sound/`: 音效
    *   `chart/`: 谱面文件
    *   `story/`: 剧情脚本

同时，根目录下会生成 **`final_decrypt_log.txt`**，其中记录了：
*   解密使用的 AES 密钥 (Hex)。
*   每个文件的恢复记录。

---

## ❓ 常见问题排查

若未成功生成文件：

1.  **检查日志**：查看 `final_decrypt_log.txt`。
    *   如果提示 *"未找到 StreamingAssetsMapping.json"*，解密虽完成但无法重命名。
2.  **检查路径**：确保 `sam` 文件夹存在，或者您正确创建了 `EncryptedSource`。
3.  **检查权限**：尝试以管理员身份运行游戏。

---

## 🔄 恢复游戏

解密完成后，为了保证游戏的正常更新和运行，请务必执行以下操作：

1.  删除修改版的 `Game.dll`。
2.  将**第 1 步**中备份的原版 `Game.dll` 复制回 `Managed` 文件夹。
3.  或者，在 Steam 中右键游戏 -> 属性 -> 已安装文件 -> **验证游戏文件的完整性**.
